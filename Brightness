#!/bin/sh
# =============================================================
# Author:  gh0stzk (modified for ddcutil by ChatGPT)
# Original Repo: https://github.com/gh0stzk/dotfiles
# Date:    Modified on 14.06.2025
#
# Brightness - Hardware brightness control using ddcutil
# Features:
#   ✔ Brightness adjustments in 5% increments
#   ✔ Configurable minimum of 2% brightness
#   ✔ OSD notifications with graphical progress bar
#
# Dependencies:
#   → ddcutil
#   → dunst
# =============================================================

#!/bin/bash

DIR="$HOME/.config/bspwm/src/assets"
BRIGHTNESS_STEPS=5
MIN_BRIGHTNESS=2

# Get the first detected monitor
MONITOR=$(ddcutil detect --brief | awk '/Display/ {print $2; exit}')

get_brightness() {
    ddcutil getvcp 10 --brief -d "$MONITOR" | awk '{print $4}'
}

send_notification() {
    brightness="$1"
    icon="$DIR/brightness.svg"
    bar=""
    bar_length=$((brightness / BRIGHTNESS_STEPS))

    i=0
    while [ "$i" -lt "$bar_length" ]; do
        bar="${bar}─"
        i=$((i + 1))
    done

    dunstify "Brightness $brightness%" -i "$icon" -r 5555 -h int:value:$(($brightness))
}

adjust_brightness() {
    current="$(get_brightness)"

    case $1 in
        up)
            if [ "$current" -eq "$MIN_BRIGHTNESS" ]; then
                ddcutil setvcp 10 "$BRIGHTNESS_STEPS" -d "$MONITOR"
            else
                ddcutil setvcp 10 + "$BRIGHTNESS_STEPS" -d "$MONITOR"
            fi
            ;;
        down)
            threshold=$((MIN_BRIGHTNESS + BRIGHTNESS_STEPS))
            if [ "$current" -le "$threshold" ]; then
                ddcutil setvcp 10 "$MIN_BRIGHTNESS" -d "$MONITOR"
            else
                ddcutil setvcp 10 - "$BRIGHTNESS_STEPS" -d "$MONITOR"
            fi
            ;;
    esac

    send_notification "$(get_brightness)"
}

case $1 in
    up|down) adjust_brightness "$1" ;;
esac

